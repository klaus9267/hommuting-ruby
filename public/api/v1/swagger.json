{
  "openapi": "3.0.1",
  "info": {
    "title": "Hommuting Crawling API V1",
    "version": "v1",
    "description": "한국 부동산 매물 수집 API - 직방 등 부동산 사이트에서 매물 데이터를 수집하는 크롤링 시스템"
  },
  "paths": {
    "/api/v1/crawling/seoul": {
      "post": {
        "summary": "서울 지역 매물 수집",
        "tags": [
          "크롤링 API"
        ],
        "description": "서울 전체 지역의 매물을 geohash 기반으로 수집합니다. CrawlingOrchestrator를 통해 직방 사이트에서 원룸, 빌라, 오피스텔 매물을 수집합니다.",
        "parameters": [
          {
            "name": "dev_mode",
            "in": "query",
            "required": false,
            "description": "개발 모드 (true/false)",
            "example": false,
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "property_types",
            "in": "query",
            "required": false,
            "items": {
              "type": "string",
              "enum": [
                "oneroom",
                "villa",
                "officetel"
              ]
            },
            "description": "수집할 매물 타입 배열 (기본값: 전체)",
            "example": [
              "oneroom",
              "villa"
            ],
            "schema": {
              "type": "array"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "수집 완료",
            "content": {
              "application/json": {
                "examples": {
                  "example_0": {
                    "value": {
                      "status": "completed",
                      "region": "seoul",
                      "total_collected": 15430,
                      "property_types": [
                        "oneroom",
                        "villa",
                        "officetel"
                      ],
                      "execution_time": 245.7,
                      "details": {
                        "oneroom": 8520,
                        "villa": 4210,
                        "officetel": 2700,
                        "errors": 0
                      }
                    }
                  }
                },
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "description": "수집 상태"
                    },
                    "region": {
                      "type": "string",
                      "description": "수집 지역"
                    },
                    "total_collected": {
                      "type": "integer",
                      "description": "수집된 매물 수"
                    },
                    "property_types": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "수집한 매물 타입들"
                    },
                    "execution_time": {
                      "type": "number",
                      "description": "실행 시간 (초)"
                    },
                    "details": {
                      "type": "object",
                      "description": "상세 수집 결과"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "수집 오류",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/crawling/gyeonggi": {
      "post": {
        "summary": "경기도 지역 매물 수집",
        "tags": [
          "크롤링 API"
        ],
        "description": "경기도 전체 지역의 매물을 geohash 기반으로 수집합니다.",
        "parameters": [
          {
            "name": "dev_mode",
            "in": "query",
            "required": false,
            "description": "개발 모드 (true/false)",
            "example": false,
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "property_types",
            "in": "query",
            "required": false,
            "items": {
              "type": "string",
              "enum": [
                "oneroom",
                "villa",
                "officetel"
              ]
            },
            "description": "수집할 매물 타입 배열",
            "schema": {
              "type": "array"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "수집 완료",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "description": "수집 상태"
                    },
                    "region": {
                      "type": "string",
                      "description": "수집 지역"
                    },
                    "total_collected": {
                      "type": "integer",
                      "description": "수집된 매물 수"
                    },
                    "property_types": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "execution_time": {
                      "type": "number",
                      "description": "실행 시간 (초)"
                    },
                    "details": {
                      "type": "object",
                      "description": "상세 수집 결과"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "수집 오류",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/crawling/all": {
      "post": {
        "summary": "전체 지역 매물 수집",
        "tags": [
          "크롤링 API"
        ],
        "description": "서울 + 경기도 전체 지역의 매물을 수집합니다.",
        "parameters": [
          {
            "name": "dev_mode",
            "in": "query",
            "required": false,
            "description": "개발 모드 (true/false)",
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "property_types",
            "in": "query",
            "required": false,
            "items": {
              "type": "string",
              "enum": [
                "oneroom",
                "villa",
                "officetel"
              ]
            },
            "description": "수집할 매물 타입 배열",
            "schema": {
              "type": "array"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "수집 완료",
            "content": {
              "application/json": {
                "examples": {
                  "example_0": {
                    "value": {
                      "status": "completed",
                      "regions": [
                        "seoul",
                        "gyeonggi"
                      ],
                      "total_collected": 28750,
                      "execution_time": 485.2,
                      "region_details": {
                        "seoul": {
                          "collected": 15430,
                          "errors": 0
                        },
                        "gyeonggi": {
                          "collected": 13320,
                          "errors": 0
                        }
                      }
                    }
                  }
                },
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "description": "수집 상태"
                    },
                    "regions": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "수집 지역들"
                    },
                    "total_collected": {
                      "type": "integer",
                      "description": "전체 수집된 매물 수"
                    },
                    "execution_time": {
                      "type": "number",
                      "description": "실행 시간 (초)"
                    },
                    "region_details": {
                      "type": "object",
                      "description": "지역별 상세 결과"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "수집 오류",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/properties/map": {
      "get": {
        "summary": "지도 기반 매물 조회",
        "tags": [
          "매물 조회 API"
        ],
        "description": "지도 경계 내 매물을 사용자 조건에 맞춰 조회합니다. PostGIS를 사용하여 효율적인 지리적 검색을 지원합니다.",
        "parameters": [
          {
            "name": "latNorth",
            "in": "query",
            "format": "float",
            "required": true,
            "description": "북쪽 위도",
            "example": 37.5665,
            "schema": {
              "type": "number"
            }
          },
          {
            "name": "lngEast",
            "in": "query",
            "format": "float",
            "required": true,
            "description": "동쪽 경도",
            "example": 127.028,
            "schema": {
              "type": "number"
            }
          },
          {
            "name": "latSouth",
            "in": "query",
            "format": "float",
            "required": true,
            "description": "남쪽 위도",
            "example": 37.5,
            "schema": {
              "type": "number"
            }
          },
          {
            "name": "lngWest",
            "in": "query",
            "format": "float",
            "required": true,
            "description": "서쪽 경도",
            "example": 126.9,
            "schema": {
              "type": "number"
            }
          },
          {
            "name": "service_types",
            "in": "query",
            "items": {
              "type": "string",
              "enum": [
                "원룸",
                "빌라",
                "오피스텔",
                "아파트"
              ]
            },
            "description": "매물 유형 배열",
            "example": [
              "원룸",
              "빌라"
            ],
            "schema": {
              "type": "array"
            }
          },
          {
            "name": "sales_types",
            "in": "query",
            "items": {
              "type": "string",
              "enum": [
                "매매",
                "전세",
                "월세"
              ]
            },
            "description": "거래 유형 배열",
            "example": [
              "전세",
              "월세"
            ],
            "schema": {
              "type": "array"
            }
          },
          {
            "name": "room_types",
            "in": "query",
            "items": {
              "type": "string",
              "enum": [
                "01",
                "02",
                "03",
                "04",
                "05",
                "06"
              ]
            },
            "description": "방 구조 배열 (01:오픈형, 02:분리형, 03:복층형, 04:투룸, 05:쓰리룸, 06:포룸+)",
            "example": [
              "01",
              "04"
            ],
            "schema": {
              "type": "array"
            }
          },
          {
            "name": "deposit_min",
            "in": "query",
            "description": "최소 보증금 (만원)",
            "example": 1000,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "deposit_max",
            "in": "query",
            "description": "최대 보증금 (만원)",
            "example": 10000,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "rent_min",
            "in": "query",
            "description": "최소 월세 (만원)",
            "example": 50,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "rent_max",
            "in": "query",
            "description": "최대 월세 (만원)",
            "example": 200,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "maintenance_fee_max",
            "in": "query",
            "description": "최대 관리비 (만원)",
            "example": 10,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "page",
            "in": "query",
            "description": "페이지 번호 (기본: 1)",
            "example": 1,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "per_page",
            "in": "query",
            "description": "페이지당 항목 수 (최대: 15)",
            "example": 15,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "매물 조회 성공",
            "content": {
              "application/json": {
                "examples": {
                  "example_0": {
                    "value": {
                      "properties": [
                        {
                          "id": 1,
                          "address": "서울특별시 강남구 역삼동 123-45",
                          "sales_type": "월세",
                          "deposit": 1000,
                          "rent": 80,
                          "service_type": "원룸",
                          "room_type": "01",
                          "room_type_name": "오픈형",
                          "floor": 3,
                          "total_floor": 10,
                          "maintenance_fee": 5,
                          "thumbnail_url": "https://example.com/thumb.jpg",
                          "latitude": 37.5,
                          "longitude": 127.05,
                          "geohash": "wydm6",
                          "price_info": "월세 1000만/80만원",
                          "floor_info": "3/10층",
                          "created_at": "2024-01-15T10:30:00Z"
                        }
                      ],
                      "total_count": 125,
                      "filters_applied": {
                        "service_types": [
                          "원룸"
                        ],
                        "sales_types": [
                          "월세"
                        ],
                        "deposit_range": [
                          1000,
                          10000
                        ]
                      },
                      "bounds": {
                        "ne_lat": 37.5665,
                        "ne_lng": 126.978,
                        "sw_lat": 37.5,
                        "sw_lng": 126.9
                      }
                    }
                  }
                },
                "schema": {
                  "type": "object",
                  "properties": {
                    "properties": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "integer",
                            "description": "매물 ID"
                          },
                          "address": {
                            "type": "string",
                            "description": "주소"
                          },
                          "sales_type": {
                            "type": "string",
                            "description": "거래 유형",
                            "enum": [
                              "매매",
                              "전세",
                              "월세"
                            ]
                          },
                          "deposit": {
                            "type": "integer",
                            "nullable": true,
                            "description": "보증금 (만원)"
                          },
                          "rent": {
                            "type": "integer",
                            "nullable": true,
                            "description": "월세 (만원)"
                          },
                          "service_type": {
                            "type": "string",
                            "description": "매물 유형",
                            "enum": [
                              "원룸",
                              "빌라",
                              "오피스텔",
                              "아파트"
                            ]
                          },
                          "room_type": {
                            "type": "string",
                            "nullable": true,
                            "description": "방 구조 코드"
                          },
                          "room_type_name": {
                            "type": "string",
                            "description": "방 구조명",
                            "enum": [
                              "오픈형",
                              "분리형",
                              "복층형",
                              "투룸",
                              "쓰리룸",
                              "포룸+",
                              "정보없음"
                            ]
                          },
                          "floor": {
                            "type": "integer",
                            "nullable": true,
                            "description": "층수"
                          },
                          "total_floor": {
                            "type": "integer",
                            "nullable": true,
                            "description": "총 층수"
                          },
                          "maintenance_fee": {
                            "type": "integer",
                            "nullable": true,
                            "description": "관리비"
                          },
                          "thumbnail_url": {
                            "type": "string",
                            "nullable": true,
                            "description": "썸네일 이미지 URL"
                          },
                          "latitude": {
                            "type": "number",
                            "format": "float",
                            "description": "위도"
                          },
                          "longitude": {
                            "type": "number",
                            "format": "float",
                            "description": "경도"
                          },
                          "geohash": {
                            "type": "string",
                            "nullable": true,
                            "description": "지오해시"
                          },
                          "price_info": {
                            "type": "string",
                            "description": "가격 정보 (formatted)"
                          },
                          "floor_info": {
                            "type": "string",
                            "nullable": true,
                            "description": "층수 정보 (formatted)"
                          },
                          "created_at": {
                            "type": "string",
                            "format": "date-time",
                            "description": "생성일시"
                          }
                        }
                      }
                    },
                    "total_count": {
                      "type": "integer",
                      "description": "전체 매물 수"
                    },
                    "filters_applied": {
                      "type": "object",
                      "description": "적용된 필터 요약",
                      "properties": {
                        "service_types": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "sales_types": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "room_types": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        },
                        "deposit_range": {
                          "type": "array",
                          "items": {
                            "type": "integer"
                          }
                        },
                        "rent_range": {
                          "type": "array",
                          "items": {
                            "type": "integer"
                          }
                        },
                        "maintenance_fee_max": {
                          "type": "integer"
                        }
                      }
                    },
                    "bounds": {
                      "type": "object",
                      "description": "조회된 지도 경계",
                      "properties": {
                        "ne_lat": {
                          "type": "number",
                          "format": "float"
                        },
                        "ne_lng": {
                          "type": "number",
                          "format": "float"
                        },
                        "sw_lat": {
                          "type": "number",
                          "format": "float"
                        },
                        "sw_lng": {
                          "type": "number",
                          "format": "float"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "잘못된 요청",
            "content": {
              "application/json": {
                "examples": {
                  "example_0": {
                    "value": {
                      "error": "매물 조회 중 오류가 발생했습니다",
                      "message": "필수 지도 경계 파라미터가 누락되었습니다: ne_lat, ne_lng"
                    }
                  }
                },
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "description": "오류 메시지"
                    },
                    "message": {
                      "type": "string",
                      "description": "상세 오류 내용"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "서버 오류",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/properties/room_types": {
      "get": {
        "summary": "방 구조 옵션 조회",
        "tags": [
          "매물 조회 API"
        ],
        "description": "매물 검색에 사용할 수 있는 방 구조 옵션 목록을 조회합니다.",
        "responses": {
          "200": {
            "description": "방 구조 옵션 조회 성공",
            "content": {
              "application/json": {
                "examples": {
                  "example_0": {
                    "value": {
                      "room_types": [
                        {
                          "code": "01",
                          "name": "오픈형"
                        },
                        {
                          "code": "02",
                          "name": "분리형"
                        },
                        {
                          "code": "03",
                          "name": "복층형"
                        },
                        {
                          "code": "04",
                          "name": "투룸"
                        },
                        {
                          "code": "05",
                          "name": "쓰리룸"
                        },
                        {
                          "code": "06",
                          "name": "포룸+"
                        }
                      ]
                    }
                  }
                },
                "schema": {
                  "type": "object",
                  "properties": {
                    "room_types": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "code": {
                            "type": "string",
                            "description": "방 구조 코드",
                            "enum": [
                              "01",
                              "02",
                              "03",
                              "04",
                              "05",
                              "06"
                            ]
                          },
                          "name": {
                            "type": "string",
                            "description": "방 구조명",
                            "enum": [
                              "오픈형",
                              "분리형",
                              "복층형",
                              "투룸",
                              "쓰리룸",
                              "포룸+"
                            ]
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "서버 오류",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    }
  },
  "servers": [
    {
      "url": "http://localhost:3001",
      "description": "Development server"
    },
    {
      "url": "https://crawling.hommuting.com",
      "description": "Production crawling server"
    }
  ],
  "components": {
    "schemas": {
      "Error": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "example": "error",
            "description": "오류 상태"
          },
          "message": {
            "type": "string",
            "description": "오류 메시지"
          },
          "error": {
            "type": "string",
            "description": "상세 오류 내용"
          }
        }
      }
    }
  }
}