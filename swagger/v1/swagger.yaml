---
openapi: 3.0.1
info:
  title: Hommuting API
  version: v1
  description: Korean Real Estate Property Aggregation API
paths:
  "/api/v1/crawling/seoul":
    post:
      summary: 서울 지역 매물 수집 (Geohash 기반)
      tags:
      - 크롤링
      description: |
        서울 지역의 부동산 매물을 geohash 기반 스트리밍 방식으로 수집합니다.

        **스트리밍 크롤링 시스템:**
        1. **ID 수집**: 각 geohash 영역별로 매물 ID를 수집 (GET 요청)
        2. **상세 정보**: 수집된 ID를 15개씩 배치로 나누어 상세 정보 조회 (POST 요청)
        3. **즉시 저장**: 각 geohash별로 독립 트랜잭션으로 DB 저장

        **개발 모드**: 1개 geohash만 테스트 수집 (wydm5)
        **전체 모드**: 서울 전체 geohash 영역 수집 (약 96개 영역, 스트리밍 처리)

        **장점**: 메모리 효율성, 실패 시 부분 복구 가능, 실시간 진행상황 확인
      parameters:
      - name: dev_mode
        in: query
        description: '개발 모드 (true: 제한된 geohash만 테스트, false: 전체 수집)'
        schema:
          type: boolean
      - name: property_types
        in: query
        items:
          type: string
          enum:
          - oneroom
          - villa
          - officetel
        description: '수집할 매물 유형 (기본값: 전체)'
        schema:
          type: array
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: 서울 전체 매물 수집 완료
                  collected_count:
                    type: integer
                    example: 1250
                  successful_geohashes:
                    type: integer
                    example: 94
                    description: 성공적으로 처리된 geohash 수
                  failed_geohashes:
                    type: integer
                    example: 2
                    description: 실패한 geohash 수
                  property_types:
                    type: object
                    properties:
                      원룸:
                        type: integer
                        example: 800
                      빌라:
                        type: integer
                        example: 300
                      오피스텔:
                        type: integer
                        example: 150
                  sample_properties:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        title:
                          type: string
                        address_text:
                          type: string
                        price:
                          type: string
                        property_type:
                          type: string
                        deal_type:
                          type: string
                        area_sqm:
                          type: number
                        current_floor:
                          type: integer
                          description: 현재 층
                        total_floors:
                          type: integer
                          description: 총 층수
                        room_structure:
                          type: string
                          example: '01'
                          description: 방 구조 코드 (01:오픈형원룸, 04:투룸, 05:쓰리룸)
                        maintenance_fee:
                          type: integer
                          description: 관리비 (원)
                        thumbnail_url:
                          type: string
                          description: 썸네일 이미지 URL
                        source:
                          type: string
                          example: zigbang_api
                        external_id:
                          type: string
                  geohash_count:
                    type: integer
                    example: 96
                  dev_mode:
                    type: boolean
                  timestamp:
                    type: string
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: error
                  message:
                    type: string
                  error:
                    type: string
  "/api/v1/crawling/gyeonggi":
    post:
      summary: 경기도 지역 매물 수집 (Geohash 기반)
      tags:
      - 크롤링
      description: |
        경기도 지역의 부동산 매물을 geohash 기반으로 수집합니다.

        서울과 동일한 2단계 크롤링 시스템을 사용하며,
        경기도 전체 geohash 영역 (약 96개)에서 매물을 수집합니다.
      parameters:
      - name: dev_mode
        in: query
        description: 개발 모드
        schema:
          type: boolean
      - name: property_types
        in: query
        items:
          type: string
          enum:
          - oneroom
          - villa
          - officetel
        description: 수집할 매물 유형
        schema:
          type: array
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/CrawlingResponse"
  "/api/v1/crawling/all":
    post:
      summary: 서울+경기도 전체 매물 수집
      tags:
      - 크롤링
      description: |
        서울과 경기도 전체 지역의 부동산 매물을 수집합니다.

        **처리 순서:**
        1. 서울 지역 전체 geohash 수집
        2. 10초 대기 (안티 봇)
        3. 경기도 지역 전체 geohash 수집

        **예상 소요 시간**: 전체 모드 시 수 시간 소요 가능
      parameters:
      - name: dev_mode
        in: query
        description: 개발 모드
        schema:
          type: boolean
      - name: property_types
        in: query
        items:
          type: string
          enum:
          - oneroom
          - villa
          - officetel
        description: 수집할 매물 유형
        schema:
          type: array
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  message:
                    type: string
                  total_collected:
                    type: integer
                  breakdown:
                    type: object
                    properties:
                      seoul:
                        type: object
                        properties:
                          count:
                            type: integer
                          geohash_count:
                            type: integer
                          property_types:
                            type: object
                          sample_properties:
                            type: array
                      gyeonggi:
                        type: object
                        properties:
                          count:
                            type: integer
                          geohash_count:
                            type: integer
                          property_types:
                            type: object
                          sample_properties:
                            type: array
                  dev_mode:
                    type: boolean
                  timestamp:
                    type: string
  "/api/v1/crawling/geohash":
    get:
      summary: Geohash 정보 조회
      tags:
      - 크롤링
      description: |
        현재 시스템에서 사용하는 geohash 목록과 관련 정보를 조회합니다.

        **Geohash란?**
        - 지리적 좌표를 짧은 문자열로 인코딩하는 시스템
        - 5글자 geohash로 서울/경기도를 약 4km×4km 격자로 분할
        - 총 192개 geohash 영역으로 전체 지역 커버
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_geohashes:
                    type: integer
                    example: 192
                  seoul:
                    type: object
                    properties:
                      count:
                        type: integer
                        example: 96
                      geohashes:
                        type: array
                        items:
                          type: string
                        example:
                        - wydm0
                        - wydm1
                        - wydm2
                        - wydm3
                        - wydm4
                  gyeonggi:
                    type: object
                    properties:
                      count:
                        type: integer
                        example: 96
                      geohashes:
                        type: array
                        items:
                          type: string
                        example:
                        - wydf0
                        - wydf1
                        - wydf2
                        - wydf3
                        - wydf4
                  supported_property_types:
                    type: array
                    items:
                      type: string
                    example:
                    - oneroom
                    - villa
                    - officetel
  "/api/v1/crawling/status":
    get:
      summary: 크롤링 상태 조회
      tags:
      - 크롤링
      description: 현재 수집된 매물 통계 및 최근 수집 정보를 조회합니다.
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_properties:
                    type: integer
                  seoul_properties:
                    type: integer
                  gyeonggi_properties:
                    type: integer
                  by_property_type:
                    type: object
                  by_deal_type:
                    type: object
                  by_source:
                    type: object
                  last_updated:
                    type: string
                  recent_properties:
                    type: array
  "/api/v1/properties":
    get:
      summary: 매물 목록 조회
      tags:
      - 매물
      description: 매물 목록을 페이지네이션과 함께 조회합니다. 매물 유형, 거래 유형, 지역 등으로 필터링 가능합니다.
      parameters:
      - name: property_type
        in: query
        enum:
        - apartment
        - villa
        - officetel
        - single_house
        - multi_house
        - mixed_use
        description: "매물 유형 필터:\n * `apartment` \n * `villa` \n * `officetel` \n *
          `single_house` \n * `multi_house` \n * `mixed_use` \n "
        schema:
          type: string
      - name: deal_type
        in: query
        enum:
        - sale
        - jeonse
        - monthly_rent
        description: 거래 유형 필터
        schema:
          type: string
      - name: source
        in: query
        description: 매물 데이터 출처 필터
        schema:
          type: string
      - name: page
        in: query
        description: '페이지 번호 (기본: 1)'
        schema:
          type: integer
      - name: per_page
        in: query
        description: '페이지당 항목 수 (기본: 20)'
        schema:
          type: integer
      - name: lat
        in: query
        description: 중심 위도
        schema:
          type: number
      - name: lng
        in: query
        description: 중심 경도
        schema:
          type: number
      - name: radius
        in: query
        description: 반경 (km)
        schema:
          type: number
      responses:
        '200':
          description: Success
          content:
            application/json:
              examples:
                success:
                  value:
                    properties:
                    - id: 1
                      title: 강남구 논현동 빌라
                      address_text: 서울시 강남구 논현동
                      price: 1000/50
                      property_type: 빌라
                      deal_type: 월세
                      area_sqm: 25.5
                      current_floor: 2
                      total_floors: 4
                      room_structure: 원룸
                      maintenance_fee: 50000
                      address:
                        local1: 서울특별시
                        local2: 강남구
                        local3: 논현동
                        full_address: 서울특별시 강남구 논현동
                      property_image:
                        thumbnail_url: https://example.com/thumb.jpg
                        image_urls:
                        - https://example.com/img1.jpg
                    pagination:
                      current_page: 1
                      per_page: 20
                      total_count: 100
              schema:
                "$ref": "#/components/schemas/PropertyList"
  "/api/v1/properties/{id}":
    parameters:
    - name: id
      in: path
      required: true
      schema:
        type: string
    get:
      summary: 매물 상세 조회
      tags:
      - 매물
      description: 특정 매물의 상세 정보를 조회합니다.
      responses:
        '200':
          description: Success
          content:
            application/json:
              examples:
                success:
                  value:
                    id: 1
                    title: 강남구 논현동 신축 빌라
                    address_text: 서울시 강남구 논현동 123-45
                    price: 50000/80
                    property_type: 빌라
                    deal_type: 월세
                    area: 33㎡
                    floor: 3층
                    description: 깔끔한 신축 빌라입니다. 교통이 편리하고 주변 상권이 발달했습니다.
                    area_description: 33㎡
                    area_sqm: 33.0
                    floor_description: 3층
                    current_floor: 3
                    total_floors: 4
                    room_structure: 투룸
                    maintenance_fee: 80000
                    latitude: 37.5172
                    longitude: 127.0473
                    source: zigbang_api
                    address:
                      id: 1
                      local1: 서울특별시
                      local2: 강남구
                      local3: 논현동
                      local4: 123-45
                      short_address: 강남구 논현동
                      full_address: 서울특별시 강남구 논현동 123-45
                    property_image:
                      id: 1
                      thumbnail_url: https://example.com/thumb.jpg
                      image_urls:
                      - https://example.com/img1.jpg
                      - https://example.com/img2.jpg
                      - https://example.com/img3.jpg
        '404':
          description: Not Found
  "/api/v1/properties/search":
    get:
      summary: 매물 검색
      tags:
      - 매물
      description: 제목, 주소, 설명에서 키워드를 검색합니다. 추가 필터링 옵션 사용 가능합니다.
      parameters:
      - name: q
        in: query
        required: true
        description: 검색어
        schema:
          type: string
      - name: property_type
        in: query
        enum:
        - apartment
        - villa
        - officetel
        - single_house
        - multi_house
        - mixed_use
        description: "매물 유형 필터:\n * `apartment` \n * `villa` \n * `officetel` \n *
          `single_house` \n * `multi_house` \n * `mixed_use` \n "
        schema:
          type: string
      - name: deal_type
        in: query
        enum:
        - sale
        - jeonse
        - monthly_rent
        description: 거래 유형 필터
        schema:
          type: string
      - name: source
        in: query
        description: 매물 데이터 출처 필터
        schema:
          type: string
      - name: page
        in: query
        description: '페이지 번호 (기본: 1)'
        schema:
          type: integer
      - name: per_page
        in: query
        description: '페이지당 항목 수 (기본: 20)'
        schema:
          type: integer
      responses:
        '200':
          description: Success
  "/api/v1/properties/stats":
    get:
      summary: 매물 통계
      tags:
      - 매물
      description: 전체 매물 통계 정보를 제공합니다. 총 개수, 유형별 분포, 최근 등록 매물 등을 포함합니다.
      responses:
        '200':
          description: Success
  "/api/v1/properties/by_area":
    get:
      summary: 지역별 매물 조회
      tags:
      - 매물
      description: 특정 좌표 중심으로 반경 내의 매물을 조회합니다. 위도, 경도와 반경을 지정하여 해당 지역의 매물을 검색할 수 있습니다.
      parameters:
      - name: lat
        in: query
        required: true
        description: '중심 위도 (예: 37.5665)'
        schema:
          type: number
      - name: lng
        in: query
        required: true
        description: '중심 경도 (예: 126.9780)'
        schema:
          type: number
      - name: radius
        in: query
        description: '검색 반경 (기본값: 0.01, 약 1km)'
        schema:
          type: number
      - name: property_type
        in: query
        enum:
        - apartment
        - villa
        - officetel
        - single_house
        - multi_house
        - mixed_use
        description: "매물 유형 필터:\n * `apartment` \n * `villa` \n * `officetel` \n *
          `single_house` \n * `multi_house` \n * `mixed_use` \n "
        schema:
          type: string
      - name: deal_type
        in: query
        enum:
        - sale
        - jeonse
        - monthly_rent
        description: 거래 유형 필터
        schema:
          type: string
      - name: source
        in: query
        description: 매물 데이터 출처 필터
        schema:
          type: string
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  center:
                    type: object
                    properties:
                      lat:
                        type: number
                      lng:
                        type: number
                  radius:
                    type: number
                  properties:
                    type: array
                    items:
                      "$ref": "#/components/schemas/Property"
                  count:
                    type: integer
        '400':
          description: Bad Request
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Latitude and longitude are required
components:
  schemas:
    Property:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        address_text:
          type: string
          description: 기본 주소 텍스트
        price:
          type: string
        property_type:
          type: string
          enum:
          - 아파트
          - 빌라
          - 오피스텔
          - 단독주택
          - 다가구
          - 주상복합
        deal_type:
          type: string
          enum:
          - 매매
          - 전세
          - 월세
        area:
          type: string
          description: 면적 (기본 표시용)
        floor:
          type: string
          description: 층수 (기본 표시용)
        description:
          type: string
          description: 매물 설명
        area_description:
          type: string
          description: 면적 상세 설명
        area_sqm:
          type: number
          format: float
          description: 면적 (제곱미터)
        floor_description:
          type: string
          description: 층수 상세 설명
        current_floor:
          type: integer
          description: 현재 층
        total_floors:
          type: integer
          description: 전체 층수
        room_structure:
          type: string
          description: '방 구조 (예: 2룸, 3룸)'
        maintenance_fee:
          type: integer
          description: 관리비 (원)
        latitude:
          type: number
          format: float
        longitude:
          type: number
          format: float
        source:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        address:
          "$ref": "#/components/schemas/Address"
        property_image:
          "$ref": "#/components/schemas/PropertyImage"
        apartment_detail:
          "$ref": "#/components/schemas/ApartmentDetail"
    Address:
      type: object
      properties:
        id:
          type: integer
        property_id:
          type: integer
        local1:
          type: string
          description: '시/도 (예: 서울특별시)'
        local2:
          type: string
          description: '구/시 (예: 강남구)'
        local3:
          type: string
          description: '동 (예: 논현동)'
        local4:
          type: string
          description: 상세 주소
        short_address:
          type: string
          description: 간단 주소 (구 + 동)
        full_address:
          type: string
          description: 전체 주소
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    PropertyImage:
      type: object
      properties:
        id:
          type: integer
        property_id:
          type: integer
        thumbnail_url:
          type: string
          format: uri
          description: 썸네일 이미지 URL
        image_urls:
          type: array
          items:
            type: string
            format: uri
          description: 매물 이미지 URL 배열
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    ApartmentDetail:
      type: object
      properties:
        id:
          type: integer
        property_id:
          type: integer
        area_ho_id:
          type: integer
          description: 직방 호 ID
        area_danji_id:
          type: integer
          description: 단지 ID
        area_danji_name:
          type: string
          description: 단지명
        danji_room_type_id:
          type: integer
          description: 단지 방 타입 ID
        dong:
          type: string
          description: 동 정보
        room_type_title:
          type: object
          description: 방 타입 제목 (다국어)
        size_contract_m2:
          type: number
          format: float
          description: 계약 면적 (제곱미터)
        tran_type:
          type: string
          description: 거래 유형
        item_type:
          type: string
          description: 매물 타입
        is_price_range:
          type: boolean
          description: 가격 범위 여부
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    PropertyList:
      type: object
      properties:
        properties:
          type: array
          items:
            "$ref": "#/components/schemas/Property"
        pagination:
          "$ref": "#/components/schemas/Pagination"
    Pagination:
      type: object
      properties:
        current_page:
          type: integer
        per_page:
          type: integer
        total_count:
          type: integer
servers:
- url: http://localhost:3000
  description: Development server
- url: https://{defaultHost}
  variables:
    defaultHost:
      default: api.hommuting.com
  description: Production server
