# 직방 크롤링 개발 계획서

## 📋 프로젝트 개요
- **목표**: 직방에서 용인시 수지구 매물 데이터 수집
- **방법**: Selenium을 이용한 동적 크롤링
- **대상 매물**: 아파트, 빌라/투룸+, 원룸, 오피스텔
- **거래 유형**: 매매, 전세, 월세

## 🎯 단계별 작업 계획

### Phase 1: 환경 설정 및 기본 구조
- [x] Selenium WebDriver 설정 (Chrome)
- [ ] Tor 프록시 연동 테스트
- [x] 기본 크롤링 서비스 구조 설계
- [x] 용인시 수지구 좌표/영역 설정

### Phase 2: 직방 사이트 분석
- [x] 각 매물 타입별 URL 패턴 분석
- [x] 지역 필터링 방법 파악 (수지구 설정)
- [ ] 페이지네이션 구조 분석 (필요시)
- [x] 매물 정보 추출 요소 식별

### Phase 3: 크롤링 로직 개발
- [x] 기본 페이지 접속 및 지역 설정
- [x] 매물 리스트 데이터 추출
- [ ] 페이지네이션 처리 (1차에서는 첫 10개만)
- [x] 각 매물 상세 정보 수집
- [x] Property 모델에 데이터 저장

### Phase 4: 안전장치 및 최적화
- [x] 요청 간격 조절 (랜덤 대기)
- [x] User-Agent 로테이션
- [x] 에러 처리 및 재시도 로직
- [ ] IP 차단 감지 및 대응

### Phase 5: 로깅 및 모니터링
- [x] 구별 크롤링 완료 로그
- [x] 매물 수집 통계 출력
- [x] 에러 로그 및 디버깅 정보

### Phase 6: 테스트 및 검증
- [x] 실제 데이터 수집 테스트 (기본 구조)
- [ ] 데이터 품질 검증 (매물 정보 추출 개선 필요)
- [x] 크롤링 속도 및 안정성 확인

### Phase 7: 매물 정보 추출 개선 (현재 진행중)
- [ ] 직방 실제 DOM 구조 상세 분석
- [ ] 올바른 CSS 선택자 확인
- [ ] 실제 매물 데이터 추출 로직 개선
- [ ] 가격, 면적, 층수 등 상세 정보 파싱

## 🏗️ 기술 스택
- **크롤링**: Selenium WebDriver
- **프록시**: Tor (IP 로테이션)
- **데이터 저장**: Rails Property 모델
- **로깅**: Rails.logger

## 📍 대상 지역 (1차 테스트)
- **용인시 수지구**
  - 좌표 범위: 대략 37.32~37.35, 127.09~127.12

## 🔗 크롤링 대상 URL
1. **아파트**: https://www.zigbang.com/home/apt/map
2. **빌라/투룸+**: https://www.zigbang.com/home/villa/map
3. **원룸**: https://www.zigbang.com/home/oneroom/map
4. **오피스텔**: https://www.zigbang.com/home/officetel/map

## 📝 개발 노트

### 2024-09-19
- 프로젝트 시작
- 작업 계획 수립
- Selenium WebDriver 기본 구조 완성
- 직방 크롤링 로직 구현 완료
- 봇 감지 방지 설정 적용
- 용인시 수지구 테스트 준비 완료

#### 구현된 주요 기능:
- 직방 4개 매물 타입별 URL 처리
- 지역 검색 및 필터링
- 매물 데이터 추출 및 저장
- 에러 처리 및 로깅
- User-Agent 로테이션
- 랜덤 대기시간 적용

#### 1차 테스트 결과 (수지구 아파트):
- ✅ 브라우저 자동화 성공
- ✅ 직방 페이지 접속 성공
- ✅ 검색창 발견 및 지역 검색 성공
- ✅ 204개 매물 카드 발견
- ✅ 10개 매물 DB 저장 성공
- ❌ 실제 매물 정보 추출 실패 (기본값으로 저장됨)

#### 발견된 문제점:
- 직방 사이트의 실제 매물 정보 CSS 구조가 예상과 다름
- 가격, 면적, 층수 등 상세 정보 추출 선택자 부정확
- React/SPA 구조로 인한 동적 콘텐츠 로딩 이슈 가능성

#### 다음 단계:
- 실제 브라우저에서 직방 매물 카드 DOM 구조 분석
- 올바른 CSS 선택자 찾기
- 매물 정보 추출 로직 개선

---

## ⚠️ 주의사항
- IP 차단 방지를 위한 적절한 요청 간격 유지
- 사이트 이용약관 준수
- 과도한 요청으로 인한 서버 부하 방지